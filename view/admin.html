<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>CrisDEV ‚Ä¢ Panel Administrativo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="../asset/img/web.png" />
  <link rel="stylesheet" href="../admin.css" />

  <!-- (Opcional) terminal web para VPS (fase 2) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
  <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js"></script>
</head>
<body>
  <div class="app">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <div class="brand">
        <img src="../asset/img/web.png" alt="logo" />
        <h1>CrisDEV ‚Ä¢ Panel</h1>
      </div>

      <button id="btnToggleNav" class="btn">‚ò∞ Men√∫</button>
      <div class="muted">Beta v2.0</div>

      <div class="muted" style="margin:10px 0 6px">Principal</div>
      <ul class="nav">
        <li><a href="#vps" data-view="vps" class="active"><span class="ico">üõ†Ô∏è</span><span class="txt">Conexiones VPS</span></a></li>
        <li><a href="#repos" data-view="repos"><span class="ico">üì¶</span><span class="txt">Repositorios JSON</span></a></li>
        <li><a href="#users" data-view="users"><span class="ico">üë§</span><span class="txt">Usuarios</span></a></li>
        <li><a href="#push" data-view="push"><span class="ico">üîî</span><span class="txt">Notificaciones</span></a></li>
        <li><a href="#premium" data-view="premium"><span class="ico">üíé</span><span class="txt">Premium</span></a></li>
      </ul>

      <div class="muted" style="margin:10px 0 6px">Configuraci√≥n</div>
      <ul class="nav">
        <li><a href="#app" data-view="app"><span class="ico">‚öôÔ∏è</span><span class="txt">App Config</span></a></li>
        <li><a href="#firebase" data-view="firebase"><span class="ico">üî•</span><span class="txt">Firebase</span></a></li>
        <li><a href="#auth" data-view="auth"><span class="ico">üîí</span><span class="txt">Admin Auth</span></a></li>
      </ul>

      <div class="muted" style="margin:10px 0 6px">Sesi√≥n</div>
      <ul class="nav">
        <li><a href="/view/logout.html"><span class="ico">üö™</span><span class="txt">Cerrar sesi√≥n</span></a></li>
      </ul>

      <div id="authInfo" class="muted" style="margin-top:12px"></div>
    </aside>

    <!-- ===== Main ===== -->
    <main class="main">
      <div class="header"><h2 id="viewTitle">Conexiones VPS</h2></div>

      <!-- ===== VPS ===== -->
      <section id="view-vps" class="view active">
      <div class="card">
        <div class="row">
          <button id="btnNewVps" class="btn btn-primary">+ Nueva VPS</button>
        </div>

        <table id="tblVps" class="table" style="margin-top:10px">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Host / IP</th>
              <th>Puerto</th>
              <th>Usuario</th>
              <th>Notas</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Editor (crear / editar) -->
      <div class="card" id="vpsEditor" style="display:none; margin-top:12px">
        <div class="row" style="justify-content:space-between; align-items:center">
          <strong id="vpsEditorTitle">Nueva VPS</strong>
          <button id="btnVpsCancel" class="btn">Cancelar</button>
        </div>

        <div class="grid-3" style="margin-top:10px">
          <div class="field">
            <label>Nombre (opcional)</label>
            <input id="vpsName" type="text" placeholder="Mi servidor" />
          </div>
          <div class="field">
            <label>Host / IP</label>
            <input id="vpsHost" type="text" placeholder="192.168.0.10 o vps.dominio.com" />
          </div>
          <div class="field">
            <label>Puerto</label>
            <input id="vpsPort" type="number" min="1" max="65535" value="22" />
          </div>
        </div>

        <div class="grid-3">
          <div class="field">
            <label>Usuario</label>
            <input id="vpsUser" type="text" value="root" />
          </div>
          <div class="field">
            <label>Contrase√±a</label>
            <input id="vpsPass" type="password" />
          </div>
          <div class="field">
            <label>Notas</label>
            <input id="vpsNotes" type="text" placeholder="Descripci√≥n corta‚Ä¶" />
          </div>
        </div>

        <div class="row">
          <button id="btnVpsSave" class="btn btn-primary">Guardar VPS</button>
          <span id="vpsMsg" class="badge" style="display:none"></span>
        </div>
      </div>

      <!-- (Opcional) Terminal ‚Äî fase 2 -->
      <div id="termCard" class="card" style="display:none; margin-top:12px">
        <div class="row" style="justify-content:space-between;align-items:center">
          <strong id="termTitle">Terminal</strong>
          <button id="btnTermClose" class="btn">Cerrar</button>
        </div>
        <div id="xterm" style="height:420px; background:#000; margin-top:10px"></div>
      </div>
    </section>


      <!-- ===== Repositorios JSON ===== -->
      <section id="view-repos" class="view">
        <div class="card grid">
          <div class="grid-2">
            <div class="field">
              <label>App</label>
              <div class="row">
                <select id="appSelect"></select>
                <input id="appNameNew" type="text" placeholder="Nueva app‚Ä¶" />
                <button id="btnCreateApp" class="btn btn-primary">Crear app</button>
              </div>
              <small class="help">Puedes administrar varios repos por app.</small>
            </div>

            <div class="field">
              <label>Repositorio</label>
              <div class="row">
                <input id="repoName" type="text" placeholder="Nombre del repositorio" />
                <input id="repoFile" type="file" accept="application/json,.json" />
                <button id="btnUploadRepo" class="btn btn-info">Subir / Actualizar</button>
              </div>
              <small class="help">Se guarda el .json completo en Storage y la metadata en Firestore.</small>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <table class="table" id="tblRepos">
            <thead>
              <tr><th>Nombre</th><th>Tama√±o</th><th>Actualizado</th><th>URL</th><th>Acciones</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- PREVIEW EN P√ÅGINA DEL REPO SELECCIONADO -->
        <div class="card" id="repoPreviewCard" style="margin-top:12px">
          <div class="row" style="justify-content:space-between; align-items:center">
            <strong>Vista del repositorio seleccionado (crudo)</strong>
            <div class="row">
              <button id="btnRepoRefresh" class="btn">Recargar</button>
              <a id="btnRepoOpenRaw" class="btn" target="_blank">Abrir ver_raw</a>
            </div>
          </div>
          <pre id="repoLive" class="ver"></pre>
        </div>
      </section>

      <!-- ===== Usuarios ===== -->
      <section id="view-users" class="view">
        <div class="card">
          <div class="row"><button id="btnReloadUsers" class="btn">Actualizar lista</button></div>
          <table id="tblUsers" class="table" style="margin-top:10px">
            <thead>
              <tr><th>Email</th><th>√öltimo acceso</th><th>Expira</th><th>Estado</th><th>Minutos</th><th>Acciones</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- ===== Notificaciones (FCM) ===== -->
      <section id="view-push" class="view">
        <div class="card grid">
          <div class="grid-3">
            <div class="field">
              <label>Destino</label>
              <select id="fcmTarget">
                <option value="topic">T√≥pico</option>
                <option value="token">Token</option>
              </select>
            </div>
            <div class="field">
              <label id="fcmTargetLabel">T√≥pico</label>
              <input id="fcmTargetValue" type="text" placeholder="p. ej. all o app-com.paquete" />
            </div>
            <div class="field">
              <label>Prioridad</label>
              <select id="fcmPriority">
                <option value="normal">normal</option>
                <option value="high">alta</option>
              </select>
            </div>
          </div>

          <div class="grid-2">
            <div class="field"><label>T√≠tulo</label><input id="fcmTitle" type="text" placeholder="Aviso / Actualizaci√≥n" /></div>
            <div class="field"><label>Texto</label><input id="fcmBody" type="text" placeholder="Mensaje‚Ä¶" /></div>
          </div>

          <div class="grid-2">
            <div class="field"><label>Imagen (URL)</label><input id="fcmImage" type="text" placeholder="https://tuapp.com/imagen.png" /></div>
            <div class="field"><label>Nombre (opcional)</label><input id="fcmName" type="text" placeholder="canal/etiqueta" /></div>
          </div>

          <div class="row">
            <button id="btnSendFCM" class="btn btn-primary">Enviar notificaci√≥n</button>
            <small class="help">Usa Cloud Messaging (HTTP v1 v√≠a Cloud Function callable).</small>
          </div>
        </div>

        <!-- PREVIEW √öLTIMO ENV√çO -->
        <div class="card" id="pushPreviewCard" style="margin-top:12px">
          <div class="row" style="justify-content:space-between; align-items:center">
            <strong>√öltimo env√≠o (payload)</strong>
            <div class="row">
              <button id="btnPushOpenRaw" class="btn" style="display:none" target="_blank">Abrir ver_raw</button>
            </div>
          </div>
          <pre id="pushLive" class="ver"></pre>
        </div>
      </section>

      <!-- ===== Premium ===== -->
      <section id="view-premium" class="view">
        <div class="card grid">
          <div class="grid-2">
            <div class="field">
              <label>Duraci√≥n predeterminada (d√≠as)</label>
              <input id="premDays" type="number" value="15" />
            </div>
          </div>
          <div class="row">
            <button id="btnSavePremium" class="btn btn-primary">Guardar</button>
          </div>
        </div>

        <!-- PREVIEW EN P√ÅGINA DE PREMIUM -->
        <div class="card" id="premPreviewCard" style="margin-top:12px">
          <div class="row" style="justify-content:space-between; align-items:center">
            <strong>Vista guardada (Premium)</strong>
            <div class="row">
              <button id="btnPremRefresh" class="btn">Recargar</button>
              <a id="btnPremOpenRaw" class="btn" target="_blank">Abrir ver_raw</a>
            </div>
          </div>
          <pre id="premLive" class="ver"></pre>
        </div>
      </section>

      <!-- ===== App Config ===== -->
      <section id="view-app" class="view">
        <div class="card grid">
          <div class="grid-2">
            <div class="field"><label>Nombre de la app</label><input id="appName" type="text" /></div>
            <div class="field"><label>Package name</label><input id="packageName" type="text" /></div>
          </div>

          <div class="grid-3">
            <div class="field"><label>AdMob App Open</label><input id="adAppOpen" type="text" /></div>
            <div class="field"><label>AdMob Banner</label><input id="adBanner" type="text" /></div>
            <div class="field"><label>AdMob Interstitial</label><input id="adInter" type="text" /></div>
          </div>

          <div class="grid-2">
            <div class="field"><label>Rewarded UnitIds (coma)</label><input id="adRewarded" type="text" /></div>
            <div class="field"><label>Test mode</label><select id="adTest"><option>false</option><option>true</option></select></div>
          </div>

          <div class="grid-3">
            <div class="field"><label>Repositorio (link)</label><input id="repoLink" type="text" /></div>
            <div class="field"><label>Servidor ‚Äî Usuario</label><input id="srvUser" type="text" /></div>
            <div class="field"><label>Servidor ‚Äî Contrase√±a</label><input id="srvPass" type="text" /></div>
          </div>

          <div class="grid-3">
            <div class="field"><label>√öltima versi√≥n</label><input id="latestVersion" type="text" /></div>
            <div class="field"><label>Versi√≥n m√≠nima</label><input id="minVersion" type="text" /></div>
            <div class="field"><label>URL de actualizaci√≥n</label><input id="updateUrl" type="text" /></div>
          </div>

          <div class="row">
            <div class="field">
              <label>Subir APK (actualizaci√≥n directa)</label>
              <input id="apkFile" type="file" accept=".apk" />
              <small class="help">Se sube a Storage y se guarda el link en la config.</small>
            </div>
            <button id="btnSaveApp" class="btn btn-primary">Guardar configuraci√≥n</button>
            <span id="appMsg" class="badge" style="display:none"></span>
          </div>
        </div>

        <!-- PREVIEW EN P√ÅGINA DE APP CONFIG -->
        <div class="card" id="appPreviewCard" style="margin-top:12px">
          <div class="row" style="justify-content:space-between; align-items:center">
            <strong>Vista guardada (App Config)</strong>
            <div class="row">
              <button id="btnAppRefresh" class="btn">Recargar</button>
              <a id="btnAppOpenRaw" class="btn" target="_blank">Abrir ver_raw</a>
            </div>
          </div>
          <pre id="appLive" class="ver"></pre>
        </div>
      </section>

      <!-- ===== Firebase ===== -->
      <section id="view-firebase" class="view">
        <div class="card grid">
          <div class="grid-3">
            <div class="field">
              <label>ID de proyecto</label>
              <div class="row">
                <input id="fbProject" type="text" readonly>
                <button id="btnCopyCfg" class="btn">Copiar config</button>
              </div>
            </div>
            <div class="field">
              <label>Tu sesi√≥n</label>
              <input id="fbEmail" type="text" readonly>
            </div>
          </div>
        </div>

        <div class="card grid" style="margin-top:14px">
          <div class="grid-3">
            <div class="field"><label>Firestore</label><a id="lnkFs" class="btn btn-outline" target="_blank">Abrir consola</a></div>
            <div class="field"><label>Realtime Database</label><a id="lnkRtdb" class="btn btn-outline" target="_blank">Abrir consola</a></div>
            <div class="field"><label>Storage</label><a id="lnkSt" class="btn btn-outline" target="_blank">Abrir consola</a></div>
          </div>
          <div class="grid-3">
            <div class="field"><label>Authentication</label><a id="lnkAuth" class="btn btn-outline" target="_blank">Abrir consola</a></div>
            <div class="field"><label>Messaging</label><a id="lnkMsg" class="btn btn-outline" target="_blank">Abrir consola</a></div>
            <div class="field"><label>Analytics</label><a id="lnkAn" class="btn btn-outline" target="_blank">Abrir consola</a></div>
          </div>
        </div>
      </section>

      <!-- ===== Admin Auth ===== -->
      <section id="view-auth" class="view">
        <div class="card">
          <p class="muted">Solo correos permitidos pueden acceder. Esta vista puede mostrar auditor√≠as o roles en el futuro.</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase inicializa en /js/auth.js -->
  <script type="module" src="../js/panel.js"></script>
</body>
</html>
