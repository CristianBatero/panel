<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>CrisDEV ‚Ä¢ Panel Administrativo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="../asset/img/web.png" />
  <!-- Tu fondo/tema -->
  <link rel="stylesheet" href="../admin.css" />
</head>
<body>

  <!-- APP -->
  <div class="app">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <div class="brand">
        <img src="../asset/img/web.png" alt="Logo">
        <h1>CrisDEV ‚Ä¢ Panel</h1>
      </div>
      <div class="muted">Beta v2.0</div>

      <div class="nav-section">
        <div class="nav-title">Principal</div>
        <ul class="nav">
          <li><a href="#vps" data-view="vps" class="active"><span class="ico">üõ†Ô∏è</span><span class="txt">Conexiones VPS</span></a></li>
          <li><a href="#repos" data-view="repos"><span class="ico">üìÅ</span><span class="txt">Repositorios JSON</span></a></li>
          <li><a href="#users" data-view="users"><span class="ico">üë•</span><span class="txt">Usuarios</span></a></li>
          <li><a href="#push" data-view="push"><span class="ico">üîî</span><span class="txt">Notificaciones</span></a></li>
          <li><a href="#premium" data-view="premium"><span class="ico">üíé</span><span class="txt">Premium</span></a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-title">Configuraci√≥n</div>
        <ul class="nav">
          <li><a href="#app" data-view="app"><span class="ico">‚öôÔ∏è</span><span class="txt">App Config</span></a></li>
          <li><a href="#firebase" data-view="firebase"><span class="ico">üî•</span><span class="txt">Firebase</span></a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-title">Sesi√≥n</div>
        <ul class="nav">
          <li><a href="#auth" data-view="auth"><span class="ico">üîê</span><span class="txt">Admin Auth</span></a></li>
        </ul>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <div class="header">
        <div class="title"><h2 id="viewTitle">Conexiones VPS</h2></div>
        <div class="userbar">
          <span id="who"></span>
          <a class="btn" href="/view/logout.html">Cerrar sesi√≥n</a>
        </div>
      </div>

      <!-- ====== VISTAS ====== -->
      <!-- VPS -->
      <section id="view-vps" class="view active">
        <div class="row" style="margin-bottom:10px">
          <button id="btnNewVps" class="btn">+ Nueva VPS</button>
          <span class="note">Conectaremos la terminal en una fase 2 (requiere backend con SSH proxy).</span>
        </div>
        <div class="card">
          <table class="table" id="tblVps">
            <thead><tr>
              <th>Nombre</th><th>Host</th><th>Puerto</th><th>Usuario</th><th>Notas</th><th></th>
            </tr></thead>
            <tbody><!-- rows din√°micas --></tbody>
          </table>
        </div>
      </section>

      <!-- Repositorios JSON -->
      <section id="view-repos" class="view">
      <div class="card grid">
        <div class="grid-2">
          <div class="field">
            <label>App</label>
            <div class="row">
              <select id="appSelect"></select>
              <input id="appNameNew" type="text" placeholder="Nueva app‚Ä¶" />
              <button id="btnCreateApp" class="btn btn-primary">Crear app</button>
            </div>
            <small class="help">Puedes administrar varios repos por app.</small>
          </div>
          <div class="field">
            <label>Repositorio</label>
            <div class="row">
              <input id="repoName" type="text" placeholder="Nombre del repositorio" />
              <input id="repoFile" type="file" accept="application/json,.json" />
              <button id="btnUploadRepo" class="btn btn-info">Subir / Actualizar</button>
            </div>
            <small class="help">Se guarda el .json completo en Storage y la metadata en Firestore.</small>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <table class="table" id="tblRepos">
          <thead>
            <tr>
              <th>Nombre</th><th>Tama√±o</th><th>Actualizado</th><th>URL</th><th>Acciones</th>
            </tr>
          </thead>
          <tbody><!-- filas din√°micas --></tbody>
        </table>
      </div>

      <div class="card" id="repoViewer" style="margin-top:12px; display:none">
        <div class="row" style="justify-content:space-between">
          <strong>Vista del JSON (sin filtros)</strong>
          <button id="btnCloseViewer" class="btn">Cerrar</button>
        </div>
        <pre id="rawView" class="raw-view"></pre>
      </div>
    </section>


      <!-- Usuarios -->
      <section id="view-users" class="view">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <div class="row">
              <button id="btnReloadUsers" class="btn">Actualizar lista</button>
            </div>
            <span class="note">Administra tiempo, bloqueos y acceso.</span>
          </div>
          <hr class="hr" />
          <table class="table" id="tblUsers">
            <thead><tr>
              <th>Email</th><th>√öltimo acceso</th><th>Expira</th><th>Estado</th><th>Minutos</th><th>Acciones</th>
            </tr></thead>
            <tbody><!-- rows din√°micas --></tbody>
          </table>
        </div>
      </section>

      <!-- Notificaciones -->
      <section id="view-push" class="view">
      <div class="card grid">
        <div class="grid-3">
          <div class="field">
            <label>Destino</label>
            <select id="fcmTarget">
              <option value="topic">T√≥pico</option>
              <option value="token">Token</option>
            </select>
          </div>
          <div class="field">
            <label id="fcmTargetLabel">T√≥pico</label>
            <input id="fcmTargetValue" type="text" placeholder="p. ej. all o app-com.paquete" />
          </div>
          <div class="field">
            <label>Prioridad</label>
            <select id="fcmPriority">
              <option value="normal">normal</option>
              <option value="high">alta</option>
            </select>
          </div>
        </div>

        <div class="grid-2">
          <div class="field"><label>T√≠tulo</label><input id="fcmTitle" type="text" placeholder="Aviso / Actualizaci√≥n" /></div>
          <div class="field"><label>Body</label><input id="fcmBody" type="text" placeholder="Mensaje‚Ä¶" /></div>
        </div>

        <div class="row">
          <button id="btnSendFCM" class="btn btn-primary">Enviar notificaci√≥n</button>
          <small class="help">Usa Cloud Messaging (HTTP v1 v√≠a Cloud Function callable).</small>
        </div>
      </div>
    </section>


      <!-- Premium (placeholder para tus reglas de negocio) -->
      <section id="view-premium" class="view">
        <div class="card grid">
          <div class="field">
            <label>Duraci√≥n predeterminada (d√≠as) para nuevas cuentas</label>
            <input id="premDays" type="number" min="1" value="15" />
          </div>
          <div class="row">
            <button id="btnSavePremium" class="btn">Guardar</button>
            <span class="note">Se aplicar√° para altas nuevas o ‚Äúreiniciar tiempo‚Äù.</span>
          </div>
        </div>
      </section>

      <!-- App Config -->
      <section id="view-app" class="view">
      <div class="card grid">
        <div class="grid-2">
          <div class="field"><label>Nombre de la app</label><input id="appName" type="text" /></div>
          <div class="field"><label>Package name</label><input id="packageName" type="text" /></div>
        </div>

        <div class="grid-3">
          <div class="field"><label>AdMob App Open</label><input id="adAppOpen" type="text" /></div>
          <div class="field"><label>AdMob Banner</label><input id="adBanner" type="text" /></div>
          <div class="field"><label>AdMob Interstitial</label><input id="adInter" type="text" /></div>
        </div>

        <div class="grid-2">
          <div class="field"><label>Rewarded UnitIds (coma)</label><input id="adRewarded" type="text" /></div>
          <div class="field"><label>Test mode</label><select id="adTest"><option>false</option><option>true</option></select></div>
        </div>

        <div class="grid-3">
          <div class="field"><label>Repositorio (link)</label><input id="repoLink" type="text" /></div>
          <div class="field"><label>Servidor ‚Äî Usuario</label><input id="srvUser" type="text" /></div>
          <div class="field"><label>Servidor ‚Äî Contrase√±a</label><input id="srvPass" type="text" /></div>
        </div>

        <div class="grid-3">
          <div class="field"><label>√öltima versi√≥n</label><input id="latestVersion" type="text" /></div>
          <div class="field"><label>Versi√≥n m√≠nima</label><input id="minVersion" type="text" /></div>
          <div class="field"><label>URL de actualizaci√≥n</label><input id="updateUrl" type="text" /></div>
        </div>

        <div class="row">
          <div class="field">
            <label>Subir APK (actualizaci√≥n directa)</label>
            <input id="apkFile" type="file" accept=".apk" />
            <small class="help">Se sube a Storage y se guarda el link en la config.</small>
          </div>
          <button id="btnSaveApp" class="btn btn-primary">Guardar configuraci√≥n</button>
          <span id="appMsg" class="badge" style="display:none"></span>
        </div>
      </div>
    </section>


      <!-- Firebase Info -->
      <section id="view-firebase" class="view">
        <div class="card grid">
          <div class="field">
            <label>Proyecto</label>
            <input id="fbProject" disabled />
          </div>
          <div class="field">
            <label>Auth ‚Äî email en sesi√≥n</label>
            <input id="fbEmail" disabled />
          </div>
          <div class="row">
            <span class="note">La seguridad final se har√° con reglas de Firestore/Storage permitiendo solo correos autorizados.</span>
          </div>
        </div>
      </section>

      <!-- Admin Auth -->
      <section id="view-auth" class="view">
        <div class="card grid">
          <div class="row" style="justify-content:space-between">
            <div>
              <div class="note">Esta sesi√≥n controla qui√©n puede escribir en la base de datos.</div>
              <div id="authInfo" class="badge ok">Cargando‚Ä¶</div>
            </div>
            <a class="btn" href="/view/logout.html">Cerrar sesi√≥n</a>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script type="module" src="../js/panel.js"></script>
</body>
</html>
